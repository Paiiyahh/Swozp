# Use an official Node.js image
FROM node:22-alpine

# Set the working directory
WORKDIR /app

# Copy package.json and package-lock.json first for caching
COPY package*.json ./

# Install all dependencies
RUN npm install

# Copy the rest of your app's source code
COPY . .

# --- THIS IS THE BUILD STEP ---
# This creates the final '/app/build' folder
RUN npm run build

# --- THIS IS THE FIX ---
# Install a lightweight static server
RUN npm install -g serve

# Expose the port you want to use
# Your original file used 8000, so we'll stick with that.
EXPOSE 8000

# This is the new command.
# It serves the static files from the 'build' folder on port 8000.
# This is what Dokploy will actually run.
CMD ["serve", "-s", "build", "-l", "8000"]